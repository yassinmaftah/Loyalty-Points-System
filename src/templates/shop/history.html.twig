{% extends "layout.html.twig" %}

{% block title %}Points History | LoyaltyPro{% endblock %}

{% block extra_css %}
<style>
    .history-wrapper {
        max-width: 1000px;
        margin: 3rem auto;
        padding: 0 1.5rem;
    }
    .history-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 2rem;
    }
    .history-header h1 { margin: 0; color: #1e293b; font-size: 1.8rem; }
    .balance-info { text-align: right; color: #64748b; }
    .balance-info strong { color: #6366f1; font-size: 1.2rem; }

    .table-container {
        background: white;
        border-radius: 15px;
        padding: 1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border: 1px solid #e2e8f0;
        overflow: hidden;
    }
    .history-table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
    }
    .history-table th {
        padding: 1.2rem;
        background: #f8fafc;
        color: #475569;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
    }
    .history-table td {
        padding: 1.2rem;
        border-bottom: 1px solid #f1f5f9;
        color: #1e293b;
        font-size: 0.95rem;
    }
    .history-table tr:last-child td { border-bottom: none; }

    /* Transaction Badges */
    .badge-type {
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.75rem;
        text-transform: uppercase;
    }
    .badge-earned { background: #dcfce7; color: #166534; }
    .badge-redeemed { background: #fee2e2; color: #991b1b; }

    .amount-val { font-weight: 700; font-family: monospace; font-size: 1.1rem; }
    .amount-earned { color: #10b981; }
    .amount-redeemed { color: #ef4444; }

    .balance-after { color: #64748b; font-weight: 600; }
    
    .footer-actions { margin-top: 2rem; text-align: center; }
    .back-link { color: #6366f1; text-decoration: none; font-weight: 600; transition: 0.2s; }
    .back-link:hover { text-decoration: underline; }
</style>
{% endblock %}

{% block content %}
<div class="history-wrapper">
    <div class="history-header">
        <h1>Transaction History</h1>
        <div class="balance-info">
            Current balance: <strong>{{ user.loyalty_points }} pts</strong>
        </div>
    </div>

    <div class="table-container">
        <table class="history-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Points</th>
                    <th>Description</th>
                    <th>New Balance</th>
                </tr>
            </thead>
            <tbody>
                {% for trans in transactions %}
                <tr>
                    <td>{{ trans.createdat|date('M d, Y') }}</td>
                    <td>
                        <span class="badge-type {{ trans.type == 'earned' ? 'badge-earned' : 'badge-redeemed' }}">
                            {{ trans.type }}
                        </span>
                    </td>
                    <td class="amount-val {{ trans.type == 'earned' ? 'amount-earned' : 'amount-redeemed' }}">
                        {{ trans.type == 'earned' ? '+' : '-' }}{{ trans.amount }}
                    </td>
                    <td>{{ trans.description }}</td>
                    <td class="balance-after">{{ trans.balance_after }} pts</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="footer-actions">
        <a href="/Loyalty-Points-System/shop" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to the boutique
        </a>
    </div>
</div>
{% endblock %}